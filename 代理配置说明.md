# 🌐 代理配置说明

## 为什么需要代理？

币安API（api.binance.com）在中国大陆无法直接访问，必须通过代理才能获取价格数据。

## 🚀 快速配置（3步搞定）

### 第1步：确认Clash正在运行
打开Clash，确保：
- ✅ Clash正在运行
- ✅ 系统代理已开启（或使用TUN模式）
- ✅ 代理端口为 7897（默认）

### 第2步：查看你的代理端口
在Clash中查看端口设置：
1. 打开Clash
2. 点击"Settings"或"设置"
3. 找到"Port"端口号（通常是7890或7897）

### 第3步：修改config.json
在程序目录下的 `config.json` 中设置代理地址：

```json
{
  "proxy": {
    "enabled": true,
    "address": "http://127.0.0.1:7897"
  },
  "update_interval": 10
}
```

**注意**：把 `7897` 改成你的Clash端口号！

## 📋 常见代理工具端口

| 工具 | 默认HTTP端口 | 配置示例 |
|------|-------------|---------|
| Clash for Windows | 7897 | `http://127.0.0.1:7897` |
| Clash Verge | 7890 | `http://127.0.0.1:7890` |
| V2rayN | 10809 | `http://127.0.0.1:10809` |
| Shadowsocks | 1080 | `http://127.0.0.1:1080` |

## 🔧 三种配置方式对比

### 方式1：配置文件 ⭐推荐
**优点**：
- ✅ 简单直观，修改方便
- ✅ 打包成exe后依然有效
- ✅ 可以随时修改不用重新编译

**配置**：
在程序目录创建 `config.json`，内容如上。

### 方式2：环境变量
**优点**：
- ✅ 全局生效，所有程序共享
- ✅ 无需配置文件

**缺点**：
- ❌ 每次重启电脑需重新设置（除非加入系统环境变量）

**Windows设置**：
```powershell
# 临时设置（当前窗口有效）
$env:HTTP_PROXY="http://127.0.0.1:7897"
$env:HTTPS_PROXY="http://127.0.0.1:7897"

# 永久设置（需要管理员权限）
[System.Environment]::SetEnvironmentVariable("HTTP_PROXY", "http://127.0.0.1:7897", "User")
[System.Environment]::SetEnvironmentVariable("HTTPS_PROXY", "http://127.0.0.1:7897", "User")
```

### 方式3：TUN模式
**优点**：
- ✅ 无需任何配置
- ✅ 全局代理，所有流量都走代理

**缺点**：
- ❌ 可能影响其他程序
- ❌ 需要管理员权限

**开启方法**：
在Clash中开启"TUN Mode"或"TUN模式"即可。

## ❓ 故障排查

### 问题1：显示"获取失败"或"N/A"

**原因**：代理未生效或代理地址错误

**解决方案**：
1. 检查Clash是否正在运行
2. 检查config.json中的端口是否正确
3. 查看控制台输出，确认代理是否被使用
4. 尝试在浏览器访问：https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT

### 问题2：控制台显示"未配置代理"

**原因**：config.json文件不存在或格式错误

**解决方案**：
1. 确认config.json文件在程序同一目录
2. 检查JSON格式是否正确（注意逗号、引号）
3. 可以删除config.json让程序使用默认配置

### 问题3：EXE打包后无法使用代理

**原因**：config.json没有和exe放在一起

**解决方案**：
1. 确保config.json和exe在同一目录
2. 或者使用环境变量方式配置
3. 或者开启Clash的TUN模式

### 问题4：代理地址不确定

**解决方案**：
1. 打开Clash主界面
2. 查看"端口"或"Port"设置
3. HTTP端口通常是7890或7897
4. 完整地址格式：`http://127.0.0.1:端口号`

## 🧪 测试代理是否工作

### 方法1：查看控制台输出
启动程序后，看到以下信息说明代理已生效：
```
已加载配置文件 config.json
✓ 使用配置代理: http://127.0.0.1:7897
✓ 价格更新间隔: 10秒
BTC价格: $xxxxx
ETH价格: $xxxxx
```

### 方法2：浏览器测试
1. 确保Clash正在运行
2. 在浏览器访问：https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT
3. 如果能看到价格数据，说明代理工作正常

### 方法3：命令行测试
```bash
# Windows PowerShell
$env:HTTP_PROXY="http://127.0.0.1:7897"
curl https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT
```

## 📝 配置文件完整示例

```json
{
  "proxy": {
    "enabled": true,
    "address": "http://127.0.0.1:7897",
    "comment": "设置为false可禁用代理（国外用户）"
  },
  "update_interval": 10,
  "comment": "价格更新间隔，单位秒，建议10-60"
}
```

## 💡 高级技巧

### 国外用户禁用代理
如果你在国外，不需要代理：
```json
{
  "proxy": {
    "enabled": false
  },
  "update_interval": 10
}
```

### 调整更新频率
更频繁的更新（5秒）：
```json
{
  "proxy": {
    "enabled": true,
    "address": "http://127.0.0.1:7897"
  },
  "update_interval": 5
}
```

### 使用其他代理工具
只要是HTTP代理，都可以使用：
```json
{
  "proxy": {
    "enabled": true,
    "address": "http://你的代理地址:端口"
  },
  "update_interval": 10
}
```

## 🎯 推荐配置

**国内用户（使用Clash）**：
```json
{
  "proxy": {
    "enabled": true,
    "address": "http://127.0.0.1:7897"
  },
  "update_interval": 10
}
```

**国外用户**：
```json
{
  "proxy": {
    "enabled": false
  },
  "update_interval": 10
}
```

---

**还有问题？** 查看主README文件或提issue！
